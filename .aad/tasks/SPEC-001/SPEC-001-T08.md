# SPEC-001-T08: Repository トレイト定義

## 基本情報

| 項目 | 内容 |
|------|------|
| **タスクID** | SPEC-001-T08 |
| **タイトル** | Repository トレイト定義 |
| **複雑度** | M（4-8時間） |
| **依存タスク** | SPEC-001-T05, SPEC-001-T06, SPEC-001-T07 |
| **優先度** | Must Have |
| **ステータス** | 未着手 |

## 概要

永続化層のインターフェースとなるRepositoryトレイトを定義します。

## 作業内容

### 1. SpecRepository トレイト
```rust
pub trait SpecRepository {
    async fn find_by_id(&self, id: &SpecId) -> Result<Option<Spec>>;
    async fn find_all(&self) -> Result<Vec<Spec>>;
    async fn save(&self, spec: &Spec) -> Result<()>;
    async fn delete(&self, id: &SpecId) -> Result<()>;
}
```

### 2. TaskRepository トレイト
```rust
pub trait TaskRepository {
    async fn find_by_id(&self, id: &TaskId) -> Result<Option<Task>>;
    async fn find_by_spec_id(&self, spec_id: &SpecId) -> Result<Vec<Task>>;
    async fn save(&self, task: &Task) -> Result<()>;
    async fn delete(&self, id: &TaskId) -> Result<()>;
}
```

### 3. SessionRepository トレイト
```rust
pub trait SessionRepository {
    async fn find_by_id(&self, id: &str) -> Result<Option<Session>>;
    async fn find_active(&self) -> Result<Vec<Session>>;
    async fn save(&self, session: &Session) -> Result<()>;
    async fn delete(&self, id: &str) -> Result<()>;
}
```

### 4. Error型定義
```rust
// crates/domain/src/error.rs
pub enum DomainError {
    NotFound(String),
    ValidationError(String),
    RepositoryError(String),
    // ...
}
```

## 変更ファイル

- `crates/domain/src/repositories/mod.rs`（更新）
- `crates/domain/src/repositories/spec_repository.rs`（新規）
- `crates/domain/src/repositories/task_repository.rs`（新規）
- `crates/domain/src/repositories/session_repository.rs`（新規）
- `crates/domain/src/error.rs`（更新）

## 受け入れ基準

- [ ] すべてのRepositoryトレイトが定義されている
- [ ] DomainError型が適切に定義されている
- [ ] 非同期（async）対応している
- [ ] rustdocコメントが記述されている
- [ ] コンパイルエラーがない

## テスト項目

```rust
#[cfg(test)]
mod tests {
    // トレイト定義のコンパイルチェック
    // 実際の実装テストは後続タスク（infrastructure層）で実施

    #[test]
    fn test_error_display() { /* ... */ }

    #[test]
    fn test_error_from_conversions() { /* ... */ }
}
```

## テストコマンド

```bash
# ビルド確認
cargo build --package domain

# テスト実行
cargo test --package domain error

# Lintチェック
cargo clippy --package domain
```

## 備考

- 実装はinfrastructure層で行う（次のSPEC）
- Result型のエイリアス定義: `type Result<T> = std::result::Result<T, DomainError>`
- 非同期ランタイム: tokio使用
