# SPEC-001-T06: Entities - Session & Workflow定義

## 基本情報

| 項目 | 内容 |
|------|------|
| **タスクID** | SPEC-001-T06 |
| **タイトル** | Entities - Session & Workflow定義 |
| **複雑度** | M（4-8時間） |
| **依存タスク** | SPEC-001-T02, SPEC-001-T03 |
| **優先度** | Must Have |
| **ステータス** | 未着手 |

## 概要

`Session`エンティティと`Workflow`エンティティを実装します。

## 作業内容

### 1. Sessionエンティティ実装
- フィールド定義:
  - `id: String`（UUID）
  - `spec_id: SpecId`
  - `task_id: Option<TaskId>`
  - `phase: Phase`
  - `started_at: DateTime<Utc>`
  - `ended_at: Option<DateTime<Utc>>`
  - `context_usage: f32`（0.0-1.0）
- メソッド実装:
  - `new()`: 新規作成
  - `end()`: セッション終了
  - `update_context_usage()`: コンテキスト使用率更新
  - `is_over_threshold()`: 閾値チェック（70%）
- Debug, Clone実装

### 2. Workflowエンティティ実装
- フィールド定義:
  - `id: String`（UUID）
  - `name: String`
  - `phases: Vec<Phase>`（フェーズ順序）
  - `current_phase: Phase`
  - `approvals: HashMap<Phase, bool>`
- メソッド実装:
  - `new()`: 新規作成
  - `next_phase()`: 次フェーズへ進む
  - `approve_phase()`: フェーズ承認
  - `can_proceed()`: 進行可能かチェック
- Debug, Clone実装

### 3. バリデーション
- Session: context_usageが0.0-1.0の範囲内
- Workflow: phases順序の整合性チェック

## 変更ファイル

- `crates/domain/src/entities/mod.rs`（更新）
- `crates/domain/src/entities/session.rs`（新規）
- `crates/domain/src/entities/workflow.rs`（新規）

## 受け入れ基準

- [ ] Sessionエンティティが正しく定義されている
- [ ] Workflowエンティティが正しく定義されている
- [ ] すべてのメソッドが正しく動作する
- [ ] バリデーションが機能する
- [ ] 単体テストがすべてパス
- [ ] テストカバレッジ80%以上
- [ ] rustdocコメントが記述されている

## テスト項目

```rust
#[cfg(test)]
mod tests {
    // Session tests
    #[test]
    fn test_session_creation() { /* ... */ }

    #[test]
    fn test_session_end() { /* ... */ }

    #[test]
    fn test_session_context_usage_update() { /* ... */ }

    #[test]
    fn test_session_threshold_check() { /* ... */ }

    // Workflow tests
    #[test]
    fn test_workflow_creation() { /* ... */ }

    #[test]
    fn test_workflow_next_phase() { /* ... */ }

    #[test]
    fn test_workflow_approve_phase() { /* ... */ }

    #[test]
    fn test_workflow_can_proceed() { /* ... */ }
}
```

## テストコマンド

```bash
# テスト実行
cargo test --package domain session workflow

# カバレッジ確認
cargo llvm-cov --package domain --html
```

## 備考

- chrono crateを使用してDateTime<Utc>を管理
- Serdeサポート（Serialize/Deserialize）を追加
- context_usage閾値（70%）は将来的に設定可能にする可能性あり
