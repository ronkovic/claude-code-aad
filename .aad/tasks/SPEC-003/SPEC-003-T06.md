# SPEC-003-T06: tasks ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…

## åŸºæœ¬æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ã‚¿ã‚¹ã‚¯ID | SPEC-003-T06 |
| SPEC | SPEC-003 |
| è¤‡é›‘åº¦ | Mï¼ˆ4-8æ™‚é–“ï¼‰ |
| å„ªå…ˆåº¦ | Must |
| ä¾å­˜ | T02, T03 |
| æ‹…å½“ | æœªã‚¢ã‚µã‚¤ãƒ³ |

---

## æ¦‚è¦

`aad tasks <spec-id>` ã§ã‚¿ã‚¹ã‚¯ã‚’åˆ†å‰²ã—ã€ã‚¿ã‚¹ã‚¯IDã‚’è‡ªå‹•æ¡ç•ªã™ã‚‹ï¼ˆSPEC-XXX-TXXå½¢å¼ï¼‰ã€‚`--github` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§GitHub Issuesã‚’ä½œæˆã™ã‚‹ã€‚

---

## ä½œæ¥­å†…å®¹

### 1. tasks ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ä½œæˆ
```rust
// crates/cli/src/commands/tasks.rs
use std::fs;
use std::path::Path;
use std::process::Command;

pub fn execute(spec_id: &str, create_github_issues: bool) -> anyhow::Result<()> {
    let spec_file = format!(".aad/specs/{}.md", spec_id);

    if !Path::new(&spec_file).exists() {
        anyhow::bail!("ã‚¨ãƒ©ãƒ¼: {} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“", spec_file);
    }

    println!("{}ã‚’ã‚¿ã‚¹ã‚¯ã«åˆ†å‰²ã—ã¾ã™...\n", spec_id);

    // 1. SPECèª­ã¿è¾¼ã¿
    let spec_content = fs::read_to_string(&spec_file)?;

    // 2. MoSCoWè¦ä»¶ã‚’æŠ½å‡ºï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰
    let must_have_count = count_requirements(&spec_content, "### Must Have");
    let should_have_count = count_requirements(&spec_content, "### Should Have");

    println!("ğŸ“‹ è¦ä»¶åˆ†æ:");
    println!("  - Must Have: {} é …ç›®", must_have_count);
    println!("  - Should Have: {} é …ç›®\n", should_have_count);

    // 3. ã‚¿ã‚¹ã‚¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    let tasks_dir = format!(".aad/tasks/{}", spec_id);
    fs::create_dir_all(&tasks_dir)?;

    // 4. ã‚¿ã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
    let total_tasks = must_have_count + should_have_count + 1; // +1 for quality check
    for i in 1..=total_tasks {
        let task_id = format!("{}-T{:02}", spec_id, i);
        let task_file = format!("{}/{}.md", tasks_dir, task_id);

        let task_content = generate_task_template(&task_id, spec_id);
        fs::write(&task_file, task_content)?;

        println!("âœ“ {} ã‚’ä½œæˆã—ã¾ã—ãŸ", task_file);
    }

    // 5. GitHub Issuesä½œæˆ
    if create_github_issues {
        println!("\nğŸ”— GitHub Issues ã‚’ä½œæˆã—ã¦ã„ã¾ã™...");
        create_github_issues_for_tasks(spec_id, total_tasks)?;
    }

    println!("\nâœ… ã‚¿ã‚¹ã‚¯åˆ†å‰²ãŒå®Œäº†ã—ã¾ã—ãŸ");
    Ok(())
}

fn count_requirements(content: &str, section: &str) -> usize {
    content
        .lines()
        .skip_while(|line| !line.starts_with(section))
        .take_while(|line| !line.starts_with("###") || line.starts_with(section))
        .filter(|line| line.trim_start().starts_with("- [ ]"))
        .count()
}

fn generate_task_template(task_id: &str, spec_id: &str) -> String {
    format!(
        r#"# {}: [ã‚¿ã‚¹ã‚¯å]

## åŸºæœ¬æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ã‚¿ã‚¹ã‚¯ID | {} |
| SPEC | {} |
| è¤‡é›‘åº¦ | Sï¼ˆ1-4æ™‚é–“ï¼‰ |
| å„ªå…ˆåº¦ | Must |
| ä¾å­˜ | ãªã— |
| æ‹…å½“ | æœªã‚¢ã‚µã‚¤ãƒ³ |

---

## æ¦‚è¦

[ã‚¿ã‚¹ã‚¯ã®æ¦‚è¦]

---

## ä½œæ¥­å†…å®¹

[å®Ÿè£…å†…å®¹ã‚’è¨˜è¿°]

---

## å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | æ“ä½œ | èª¬æ˜ |
|----------|------|------|
| [ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹] | æ–°è¦/å¤‰æ›´ | [èª¬æ˜] |

---

## å—ã‘å…¥ã‚ŒåŸºæº–

- [ ] AC-1: [å—ã‘å…¥ã‚ŒåŸºæº–]

---

## ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰

```bash
[ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰]
```
"#,
        task_id, task_id, spec_id
    )
}

fn create_github_issues_for_tasks(spec_id: &str, total_tasks: usize) -> anyhow::Result<()> {
    for i in 1..=total_tasks {
        let task_id = format!("{}-T{:02}", spec_id, i);
        let title = format!("{}: ã‚¿ã‚¹ã‚¯å®Ÿè£…", task_id);

        let output = Command::new("gh")
            .args(&[
                "issue",
                "create",
                "--title",
                &title,
                "--body",
                &format!("è©³ç´°: .aad/tasks/{}/{}.md", spec_id, task_id),
            ])
            .output()?;

        if output.status.success() {
            println!("  âœ“ Issueä½œæˆ: {}", task_id);
        } else {
            eprintln!("  âš  Issueä½œæˆå¤±æ•—: {}", task_id);
        }
    }

    Ok(())
}
```

### 2. main.rs ã«çµ±åˆ
```rust
Commands::Tasks { spec_id, github } => {
    commands::tasks::execute(&spec_id, github)?
}
```

---

## å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | æ“ä½œ | èª¬æ˜ |
|----------|------|------|
| `crates/cli/src/commands/tasks.rs` | æ–°è¦ | tasks ã‚³ãƒãƒ³ãƒ‰å®Ÿè£… |
| `crates/cli/src/commands/mod.rs` | å¤‰æ›´ | tasks ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ  |
| `crates/cli/src/main.rs` | å¤‰æ›´ | tasks ã‚³ãƒãƒ³ãƒ‰å‘¼ã³å‡ºã— |

---

## å—ã‘å…¥ã‚ŒåŸºæº–

- [ ] AC-6.1: `aad tasks SPEC-001` å®Ÿè¡Œå¾Œã€`.aad/tasks/SPEC-001-tasks.md` ãŒä½œæˆã•ã‚Œã‚‹
- [ ] AC-6.2: ã‚¿ã‚¹ã‚¯IDãŒ `SPEC-001-T01`, `SPEC-001-T02`, ... ã¨è‡ªå‹•æ¡ç•ªã•ã‚Œã‚‹
- [ ] AC-6.3: `--github` ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®šæ™‚ã€GitHub Issues ãŒä½œæˆã•ã‚Œã‚‹ï¼ˆ`gh` ã‚³ãƒãƒ³ãƒ‰ä½¿ç”¨ï¼‰
- [ ] AC-6.4: ä¾å­˜é–¢ä¿‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å«ã¾ã‚Œã¦ã„ã‚‹

---

## ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰

```bash
# tasks ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
cargo run -p cli -- tasks SPEC-003

# GitHub Issuesä½œæˆ
cargo run -p cli -- tasks SPEC-003 --github

# ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
ls .aad/tasks/SPEC-003/
```

---

## å‚™è€ƒ

- ç¾æ®µéšã§ã¯ç°¡æ˜“çš„ãªè¦ä»¶ã‚«ã‚¦ãƒ³ãƒˆã®ã¿å®Ÿè£…
- è©³ç´°ãªã‚¿ã‚¹ã‚¯åˆ†å‰²ãƒ­ã‚¸ãƒƒã‚¯ã¯å°†æ¥çš„ã«æ”¹å–„äºˆå®š
- GitHub Issuesä½œæˆã«ã¯ `gh` CLI ãŒå¿…è¦
