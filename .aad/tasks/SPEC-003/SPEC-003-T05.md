# SPEC-003-T05: spec コマンド実装

## 基本情報

| 項目 | 内容 |
|------|------|
| タスクID | SPEC-003-T05 |
| SPEC | SPEC-003 |
| 複雑度 | S（1-4時間） |
| 優先度 | Must |
| 依存 | T02, T03 |
| 担当 | 未アサイン |

---

## 概要

`aad spec <spec-id>` で仕様ファイルを作成し、受け入れ基準のテンプレートを生成する。MoSCoW 優先度セクションを含める。

---

## 作業内容

### 1. spec コマンドハンドラ作成
```rust
// crates/cli/src/commands/spec.rs
use std::fs;
use std::path::Path;

pub fn execute(spec_id: &str) -> anyhow::Result<()> {
    let file_path = format!(".aad/specs/{}.md", spec_id);

    if Path::new(&file_path).exists() {
        anyhow::bail!("エラー: {} は既に存在します", file_path);
    }

    // テンプレート生成
    let template = generate_spec_template(spec_id);

    fs::write(&file_path, template)?;
    println!("✓ {} を作成しました", file_path);

    Ok(())
}

fn generate_spec_template(spec_id: &str) -> String {
    format!(
        r#"# {}: [タイトル]

**作成日**: {}

**担当者**: 未定

**ステータス**: Draft

**関連Issue**: N/A

---

## 📋 概要

[仕様の概要を記述]

---

## 🎯 目的

### ビジネス目標
[ビジネス目標を記述]

### ユーザーストーリー
```
As a [ユーザー]
I want to [やりたいこと]
So that [得られる価値]
```

---

## 🔍 要件定義（MoSCoW）

### Must Have（必須）
これらがないとリリースできない機能

- [ ] **REQ-1**: [要件名] - [要件説明]

### Should Have（重要）
できるだけ含めるべき機能

- なし

### Could Have（あれば良い）
リソースに余裕があれば追加する機能

- なし

### Won't Have（対象外）
今回は実装しないことを明示

- [ ] **[機能名]** - 理由: [理由]

---

## ✅ 受け入れ基準

テスト可能な形式で記述すること

### 機能テスト

#### REQ-1: [要件名]
- [ ] AC-1.1: [受け入れ基準]
- [ ] AC-1.2: [受け入れ基準]

### 非機能テスト
- [ ] パフォーマンス要件を満たす
- [ ] セキュリティ要件を満たす

---

## 📝 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|----------|--------|
| {} | 1.0 | 初版作成 | 未定 |

---

## ✅ 承認

- [ ] 技術レビュー完了（担当: 未定、日付: 未定）
- [ ] ビジネスレビュー完了（担当: 未定、日付: 未定）
- [ ] 最終承認（担当: 未定、日付: 未定）
"#,
        spec_id,
        chrono::Local::now().format("%Y-%m-%d"),
        chrono::Local::now().format("%Y-%m-%d")
    )
}
```

### 2. Cargo.toml に chrono 追加
```toml
[dependencies]
chrono = "0.4"
```

### 3. main.rs に統合
```rust
Commands::Spec { spec_id } => commands::spec::execute(&spec_id)?,
```

---

## 変更ファイル

| ファイル | 操作 | 説明 |
|----------|------|------|
| `crates/cli/src/commands/spec.rs` | 新規 | spec コマンド実装 |
| `crates/cli/src/commands/mod.rs` | 変更 | spec モジュール追加 |
| `crates/cli/Cargo.toml` | 変更 | chrono 依存追加 |
| `crates/cli/src/main.rs` | 変更 | spec コマンド呼び出し |

---

## 受け入れ基準

- [ ] AC-5.1: `aad spec SPEC-001` 実行後、`.aad/specs/SPEC-001.md` が作成される
- [ ] AC-5.2: テンプレートに MoSCoW 優先度セクションが含まれている
- [ ] AC-5.3: 受け入れ基準のプレースホルダーが含まれている
- [ ] AC-5.4: 既存の spec ファイルがある場合は上書き確認が表示される

---

## テストコマンド

```bash
# spec コマンド実行
cargo run -p cli -- spec SPEC-999

# ファイル確認
cat .aad/specs/SPEC-999.md

# 既存ファイル上書き確認
cargo run -p cli -- spec SPEC-999
```

---

## 期待結果

```
✓ .aad/specs/SPEC-999.md を作成しました
```

---

## 備考

- テンプレートは文字列リテラルで定義
- 日付は chrono で自動生成
