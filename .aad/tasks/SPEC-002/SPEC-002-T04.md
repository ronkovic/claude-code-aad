# SPEC-002-T04: StyleConfig 構造体実装

## 基本情報

| 項目 | 内容 |
|------|------|
| タスクID | SPEC-002-T04 |
| SPEC | SPEC-002 |
| 複雑度 | M（4-8時間） |
| 優先度 | Must |
| 依存 | T02 |
| 担当 | 未アサイン |

---

## 概要

`config/styles.toml` ファイルを読み込み、スタイル定義を `StyleName` と `TokenMap` にマッピングする。未定義スタイルやトークン重複を検出する。

---

## 作業内容

### 1. StyleConfig 構造体定義
```rust
use domain::value_objects::{StyleName, TokenMap};
use std::collections::HashMap;

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct StyleConfig {
    pub styles: HashMap<String, StyleDefinition>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct StyleDefinition {
    pub description: Option<String>,
    pub tokens: HashMap<String, String>,
}
```

### 2. 読み込みロジック実装
- `StyleConfig::load(path: &Path) -> Result<Self, Error>`
- ファイル存在チェック
- TOML パース
- StyleName と TokenMap への変換

### 3. アクセサメソッド実装
- `get_token_map(&self, name: &StyleName) -> Option<&TokenMap>`
- 未定義スタイルへのアクセス時のエラーハンドリング

### 4. サンプル設定ファイル作成
- `config/styles.toml` を作成（standard, sage スタイル）

---

## 変更ファイル

| ファイル | 操作 | 説明 |
|----------|------|------|
| `crates/infrastructure/src/config/mod.rs` | 変更 | style_config モジュールを追加 |
| `crates/infrastructure/src/config/style_config.rs` | 新規 | StyleConfig 実装 |
| `config/styles.toml` | 新規 | サンプルスタイル設定 |

---

## 受け入れ基準

- [ ] AC-4.1: `infrastructure/src/config/style_config.rs` に `StyleConfig` 構造体が定義されている
- [ ] AC-4.2: `StyleConfig::load(path)` メソッドが実装されている
- [ ] AC-4.3: 各スタイル定義が `StyleName` と `TokenMap` にマッピングされる
- [ ] AC-4.4: 未定義のスタイルへのアクセス時にエラーを返す
- [ ] AC-4.5: トークン名の重複が検出される

---

## テスト項目

| テスト | 内容 | 期待結果 |
|--------|------|----------|
| test_style_config_load | 正常なスタイル設定の読み込み | 成功 |
| test_style_config_get_token_map | スタイル名からTokenMap取得 | 正しいマッピングを返す |
| test_style_config_undefined_style | 未定義スタイルへのアクセス | None を返す |
| test_style_config_invalid_toml | 不正なTOML構文 | エラーを返す |
| test_style_config_duplicate_token | トークン名重複 | 警告またはエラー |
| test_style_config_empty_styles | スタイル定義が空 | 空のHashMapを返す |

---

## テストコマンド

```bash
# テスト実行
cargo test -p infrastructure style_config

# 全テスト
cargo test --all
```

---

## 備考

- T03（AadConfig）と並列実行可能
- Domain層の StyleName, TokenMap を活用
- 既存の `config/styles.toml` があれば参照
