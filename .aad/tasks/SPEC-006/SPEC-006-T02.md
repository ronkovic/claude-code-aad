# SPEC-006-T02: App構造体・状態管理実装

## 基本情報

| 項目 | 内容 |
|------|------|
| タスクID | SPEC-006-T02 |
| SPEC | SPEC-006 |
| 複雑度 | M（4-8時間） |
| 優先度 | Must |
| 依存 | T01 |
| 担当 | 未アサイン |

---

## 概要

TUI アプリケーション状態を管理する `App` 構造体を実装する。現在の画面（`View`）を保持し、`update()` と `render()` メソッドで状態更新と画面描画を行う。

---

## 作業内容

### 1. View enumの実装
`src/views/mod.rs` に View 列挙型を定義:
```rust
/// TUI画面種別
#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum View {
    Dashboard,
    Monitor,
    Workflow,
    Detail,
}

impl View {
    pub fn next(&self) -> Self {
        match self {
            View::Dashboard => View::Monitor,
            View::Monitor => View::Workflow,
            View::Workflow => View::Detail,
            View::Detail => View::Dashboard,
        }
    }
}
```

### 2. App構造体の実装
`src/app.rs` に App 構造体を実装:
```rust
use ratatui::Frame;
use anyhow::Result;
use crossterm::event::Event;
use crate::views::View;

/// TUIアプリケーション状態
pub struct App {
    current_view: View,
    selected_index: usize,
    should_quit: bool,
}

impl App {
    /// 新しいAppを作成
    pub fn new() -> Self {
        Self {
            current_view: View::Dashboard,
            selected_index: 0,
            should_quit: false,
        }
    }

    /// 状態を更新
    pub fn update(&mut self) {
        // 後のタスクで実装
    }

    /// 画面を描画
    pub fn render(&mut self, frame: &mut Frame) {
        // 後のタスクで実装
    }

    /// イベントを処理
    pub fn handle_event(&mut self, event: Event) -> Result<()> {
        // 後のタスクで実装
        Ok(())
    }

    /// 終了すべきか
    pub fn should_quit(&self) -> bool {
        self.should_quit
    }
}

impl Default for App {
    fn default() -> Self {
        Self::new()
    }
}
```

### 3. ユニットテストの追加
```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_app_creation() {
        let app = App::new();
        assert_eq!(app.current_view, View::Dashboard);
        assert_eq!(app.selected_index, 0);
        assert!(!app.should_quit);
    }

    #[test]
    fn test_view_navigation() {
        assert_eq!(View::Dashboard.next(), View::Monitor);
        assert_eq!(View::Monitor.next(), View::Workflow);
        assert_eq!(View::Workflow.next(), View::Detail);
        assert_eq!(View::Detail.next(), View::Dashboard);
    }
}
```

---

## 変更ファイル

- `crates/tui/src/app.rs` - App構造体実装
- `crates/tui/src/views/mod.rs` - View enum実装

---

## 受け入れ基準

### AC-2.1: `tui/src/app.rs` に `App` 構造体が定義されている
```bash
grep "pub struct App" crates/tui/src/app.rs
```

### AC-2.2: 現在の画面（`View`）を保持する状態フィールドがある
```bash
grep "current_view: View" crates/tui/src/app.rs
```

### AC-2.3: `update()` メソッドで状態更新が行われる
```bash
grep "pub fn update" crates/tui/src/app.rs
```

### AC-2.4: `render()` メソッドで画面描画が行われる
```bash
grep "pub fn render" crates/tui/src/app.rs
```

### AC-2.5: 画面遷移ロジックが実装されている
```bash
grep "fn next" crates/tui/src/views/mod.rs
```

---

## テストコマンド

```bash
# ユニットテスト実行
cargo test -p tui

# ビルド確認
cargo build -p tui

# Lintチェック
cargo clippy -p tui -- -D warnings
```

---

## 期待結果

| チェック項目 | 期待結果 |
|-------------|----------|
| App構造体 | View状態を保持 |
| メソッド | update(), render() が定義されている |
| テスト | 全テスト成功 |

---

## 備考

- update() と render() は後のタスクで実装を充実させる
- 現段階ではスタブで問題なし
