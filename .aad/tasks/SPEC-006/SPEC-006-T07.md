# SPEC-006-T07: 品質チェック

## 基本情報

| 項目 | 内容 |
|------|------|
| タスクID | SPEC-006-T07 |
| SPEC | SPEC-006 |
| 複雑度 | S（1-4時間） |
| 優先度 | Must |
| 依存 | T01-T06 |
| 担当 | 未アサイン |

---

## 概要

SPEC-006 の全実装が完了した後、品質チェック（ビルド、テスト、Lint、フォーマット）を実行し、受け入れ基準を満たすことを確認する。

---

## 作業内容

### 1. ビルド確認
```bash
cargo build --all
cargo build -p tui --release
cargo build -p cli --release
```

### 2. テスト実行
```bash
cargo test --all
cargo test -p tui
cargo test -p cli
```

### 3. Lintチェック
```bash
cargo clippy --all -- -D warnings
cargo clippy -p tui -- -D warnings
cargo clippy -p cli -- -D warnings
```

### 4. フォーマットチェック
```bash
cargo fmt --all -- --check
```

### 5. 統合テスト（手動）
```bash
# 1. monitor コマンド起動
cargo run -p cli -- monitor

# キーボード操作確認:
# - Tab キーでView切り替え
# - ↑↓ キーでリスト選択
# - Enter キーで詳細画面遷移
# - Esc キーで戻る
# - q キーで終了

# 2. 更新間隔のテスト
cargo run -p cli -- monitor --interval 2

# 3. ヘルプメッセージ確認
cargo run -p cli -- monitor --help
```

### 6. UI確認
- ダッシュボードが正しく表示される
- Widget（ContextBar, PhaseIndicator, SessionList）が表示される
- 70%ルールに基づくContextBarの色分けが正しい
- キーボード操作が快適である

### 7. パフォーマンス確認
```bash
# 画面描画時間のチェック（目視で60fps相当かを確認）
cargo run -p cli --release -- monitor
```

---

## 変更ファイル

なし（検証のみ）

---

## 受け入れ基準

### 機能テスト

#### REQ-1: tui クレート作成
- [ ] `crates/tui/Cargo.toml` が存在する
- [ ] `ratatui` クレート（v0.28）が依存に含まれている
- [ ] `crossterm` クレートが依存に含まれている
- [ ] `cargo build -p tui` が成功する

#### REQ-2: App 構造体・状態管理実装
- [ ] `tui/src/app.rs` に `App` 構造体が定義されている
- [ ] 現在の画面（`View`）を保持する状態フィールドがある
- [ ] `update()` メソッドで状態更新が行われる
- [ ] `render()` メソッドで画面描画が行われる
- [ ] 画面遷移ロジックが実装されている

#### REQ-3: Widgets 実装
- [ ] `tui/src/widgets/session_list.rs` が実装されている
- [ ] `tui/src/widgets/task_progress.rs` が実装されている
- [ ] `tui/src/widgets/spec_tree.rs` が実装されている
- [ ] `tui/src/widgets/context_bar.rs` が実装されている（70%ルールの可視化）
- [ ] `tui/src/widgets/phase_indicator.rs` が実装されている
- [ ] 各 Widget が `ratatui::widgets::Widget` トレイトを実装している

#### REQ-4: Views 実装
- [ ] `tui/src/views/dashboard.rs` が実装されている
- [ ] `tui/src/views/monitor.rs` が実装されている
- [ ] `tui/src/views/workflow.rs` が実装されている
- [ ] `tui/src/views/detail.rs` が実装されている
- [ ] 各 View が適切な Widget を組み合わせて表示している

#### REQ-5: キーボードイベント処理実装
- [ ] `tui/src/events.rs` にイベントハンドラが実装されている
- [ ] `q` キーで終了できる
- [ ] `Tab` キーで View が切り替わる
- [ ] `↑` `↓` キーでリストが選択できる
- [ ] `Enter` キーで詳細画面に遷移できる
- [ ] `Esc` キーで前の画面に戻れる

#### REQ-6: monitor コマンド連携
- [ ] `cli/src/commands/monitor.rs` が実装されている
- [ ] `aad monitor` 実行で TUI が起動する
- [ ] 1秒ごとにセッション状態が更新される
- [ ] リアルタイムで進捗が反映される
- [ ] `Ctrl+C` または `q` キーで正常終了できる

### 非機能テスト
- [ ] `aad monitor` でダッシュボードが起動する
- [ ] リアルタイム更新が動作する
- [ ] キーボード操作が快適である
- [ ] UI が見やすく整理されている
- [ ] `cargo test -p tui` が全て pass する

---

## テストコマンド

```bash
# 全品質チェック実行
./scripts/quality-check.sh

# または個別実行
cargo build --all
cargo test --all
cargo clippy --all -- -D warnings
cargo fmt --all -- --check

# 手動統合テスト
cargo run -p cli -- monitor
```

---

## 期待結果

| チェック項目 | 期待結果 |
|-------------|----------|
| ビルド | エラーゼロ |
| テスト | 全テスト成功 |
| Clippy | 警告ゼロ（-D warningsモード） |
| Rustfmt | フォーマット問題なし |
| 統合テスト | 全機能正常動作 |
| UI確認 | ダッシュボードが正しく表示される |
| パフォーマンス | 画面描画が快適（60fps相当） |

---

## 備考

- このタスクは全タスク完了後に実行
- 問題があれば該当タスクに戻って修正
- 統合テストは手動実行が必要
- 70%ルールのContextBar色分けが正しく動作していることを確認
