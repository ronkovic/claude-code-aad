# SPEC-006-T04: Views実装

## 基本情報

| 項目 | 内容 |
|------|------|
| タスクID | SPEC-006-T04 |
| SPEC | SPEC-006 |
| 複雑度 | M（4-8時間） |
| 優先度 | Must |
| 依存 | T03 |
| 担当 | 未アサイン |

---

## 概要

`Dashboard`, `Monitor`, `Workflow`, `Detail` の4つのViewを実装する。各Viewは適切なWidgetを組み合わせて表示する。

---

## 作業内容

### 1. views/mod.rs の更新
```rust
//! TUI Views

pub mod dashboard;
pub mod monitor;
pub mod workflow;
pub mod detail;

pub use dashboard::DashboardView;
pub use monitor::MonitorView;
pub use workflow::WorkflowView;
pub use detail::DetailView;

/// TUI画面種別
#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum View {
    Dashboard,
    Monitor,
    Workflow,
    Detail,
}

impl View {
    pub fn next(&self) -> Self {
        match self {
            View::Dashboard => View::Monitor,
            View::Monitor => View::Workflow,
            View::Workflow => View::Detail,
            View::Detail => View::Dashboard,
        }
    }
}
```

### 2. DashboardView の実装
`src/views/dashboard.rs`:
```rust
use ratatui::{
    buffer::Buffer,
    layout::{Constraint, Direction, Layout, Rect},
    widgets::Widget,
};
use crate::widgets::{ContextBar, PhaseIndicator, SessionList};

/// メインダッシュボード画面
pub struct DashboardView<'a> {
    context_usage: f64,
    current_phase: &'a str,
    sessions: Vec<&'a str>,
    selected: usize,
}

impl<'a> DashboardView<'a> {
    pub fn new(
        context_usage: f64,
        current_phase: &'a str,
        sessions: Vec<&'a str>,
        selected: usize,
    ) -> Self {
        Self {
            context_usage,
            current_phase,
            sessions,
            selected,
        }
    }
}

impl<'a> Widget for DashboardView<'a> {
    fn render(self, area: Rect, buf: &mut Buffer) {
        let chunks = Layout::default()
            .direction(Direction::Vertical)
            .constraints([
                Constraint::Length(3), // ContextBar
                Constraint::Length(3), // PhaseIndicator
                Constraint::Min(0),    // SessionList
            ])
            .split(area);

        ContextBar::new(self.context_usage).render(chunks[0], buf);
        PhaseIndicator::new(self.current_phase).render(chunks[1], buf);
        SessionList::new(self.sessions, self.selected).render(chunks[2], buf);
    }
}
```

### 3. MonitorView の実装
`src/views/monitor.rs`:
```rust
use ratatui::{
    buffer::Buffer,
    layout::{Constraint, Direction, Layout, Rect},
    widgets::{Block, Borders, Paragraph, Widget},
};
use crate::widgets::TaskProgress;

/// 監視画面
pub struct MonitorView<'a> {
    spec_id: &'a str,
    tasks: Vec<(&'a str, f64)>, // (task_name, progress)
}

impl<'a> MonitorView<'a> {
    pub fn new(spec_id: &'a str, tasks: Vec<(&'a str, f64)>) -> Self {
        Self { spec_id, tasks }
    }
}

impl<'a> Widget for MonitorView<'a> {
    fn render(self, area: Rect, buf: &mut Buffer) {
        let title = Paragraph::new(format!("Monitor: {}", self.spec_id))
            .block(Block::default().borders(Borders::ALL));

        let chunks = Layout::default()
            .direction(Direction::Vertical)
            .constraints(
                std::iter::once(Constraint::Length(3))
                    .chain(
                        self.tasks
                            .iter()
                            .map(|_| Constraint::Length(3)),
                    )
                    .collect::<Vec<_>>(),
            )
            .split(area);

        title.render(chunks[0], buf);

        for (i, (task_name, progress)) in self.tasks.iter().enumerate() {
            TaskProgress::new(task_name, *progress).render(chunks[i + 1], buf);
        }
    }
}
```

### 4. WorkflowView の実装
`src/views/workflow.rs`:
```rust
use ratatui::{
    buffer::Buffer,
    layout::Rect,
    widgets::{Block, Borders, Paragraph, Widget},
};

/// ワークフロー画面
pub struct WorkflowView<'a> {
    workflow_text: &'a str,
}

impl<'a> WorkflowView<'a> {
    pub fn new(workflow_text: &'a str) -> Self {
        Self { workflow_text }
    }
}

impl<'a> Widget for WorkflowView<'a> {
    fn render(self, area: Rect, buf: &mut Buffer) {
        let paragraph = Paragraph::new(self.workflow_text)
            .block(Block::default().title("Workflow").borders(Borders::ALL));

        paragraph.render(area, buf);
    }
}
```

### 5. DetailView の実装
`src/views/detail.rs`:
```rust
use ratatui::{
    buffer::Buffer,
    layout::Rect,
    widgets::{Block, Borders, Paragraph, Widget},
};

/// 詳細画面
pub struct DetailView<'a> {
    detail_text: &'a str,
}

impl<'a> DetailView<'a> {
    pub fn new(detail_text: &'a str) -> Self {
        Self { detail_text }
    }
}

impl<'a> Widget for DetailView<'a> {
    fn render(self, area: Rect, buf: &mut Buffer) {
        let paragraph = Paragraph::new(self.detail_text)
            .block(Block::default().title("Detail").borders(Borders::ALL));

        paragraph.render(area, buf);
    }
}
```

### 6. App::render() の更新
`src/app.rs` の `render()` メソッドを更新して各Viewを使用する。

---

## 変更ファイル

- `crates/tui/src/views/mod.rs` - 更新
- `crates/tui/src/views/dashboard.rs` - 新規作成
- `crates/tui/src/views/monitor.rs` - 新規作成
- `crates/tui/src/views/workflow.rs` - 新規作成
- `crates/tui/src/views/detail.rs` - 新規作成
- `crates/tui/src/app.rs` - render()メソッド更新

---

## 受け入れ基準

### AC-4.1: `tui/src/views/dashboard.rs` が実装されている
```bash
test -f crates/tui/src/views/dashboard.rs
```

### AC-4.2: `tui/src/views/monitor.rs` が実装されている
```bash
test -f crates/tui/src/views/monitor.rs
```

### AC-4.3: `tui/src/views/workflow.rs` が実装されている
```bash
test -f crates/tui/src/views/workflow.rs
```

### AC-4.4: `tui/src/views/detail.rs` が実装されている
```bash
test -f crates/tui/src/views/detail.rs
```

### AC-4.5: 各 View が適切な Widget を組み合わせて表示している
```bash
grep "ContextBar" crates/tui/src/views/dashboard.rs
grep "TaskProgress" crates/tui/src/views/monitor.rs
```

---

## テストコマンド

```bash
# ビルド確認
cargo build -p tui

# テスト実行
cargo test -p tui

# Lintチェック
cargo clippy -p tui -- -D warnings
```

---

## 期待結果

| チェック項目 | 期待結果 |
|-------------|----------|
| View実装 | 4つのView全て実装 |
| Widget統合 | 各ViewでWidgetが使用されている |
| ビルド | エラーゼロ |

---

## 備考

- DashboardView は ContextBar, PhaseIndicator, SessionList を組み合わせる
- MonitorView は TaskProgress を複数表示する
- WorkflowView と DetailView は後で拡張予定
