# 全自動オーケストレーション

SPECからタスク分割、並列開発、統合まで全て自動実行します。

## 実行内容

1. **SPEC確認**
   - `.aad/specs/SPEC-XXX.md` を読み込み
   - 承認済みか確認（人間承認必須）

2. **タスク分割**
   - `/aad:tasks SPEC-XXX` を実行
   - GitHub Issues作成

3. **依存関係解析**
   - タスク間の依存関係を解析
   - 並列実行可能なタスクを特定

4. **並列ワーカー起動**
   - 依存関係のないタスクを並列実行
   - Docker環境で各ワーカーを起動
   - `--dangerously-skip-permissions` で自律実行

5. **進捗監視**
   - 各ワーカーの状態を監視
   - エスカレーション発生時は通知
   - 品質ゲートを自動チェック

6. **順次統合**
   - 完了したタスクから順次マージ
   - コンフリクト発生時は人間にエスカレーション

7. **振り返り**
   - 全タスク完了後、自動で `/aad:retro` 実行

## 使用方法

### 完全自動モード

```
/aad:orchestrate SPEC-001
```

### ドライランモード（実行前確認）

```
/aad:orchestrate SPEC-001 --dry-run
```

### 並列度指定

```
/aad:orchestrate SPEC-001 --workers=3
```

## 出力例

```
全自動オーケストレーションを開始します: SPEC-001

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 Phase 1: SPEC確認
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ SPEC-001: ユーザー認証機能
   ステータス: Approved
   承認者: @owner
   承認日: 2026-01-10

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 Phase 2: タスク分割
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ タスク分割完了: 5タスク
✅ GitHub Issues作成完了: #12-#16

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 Phase 3: 依存関係解析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

依存関係グラフ:
  T01: データベーススキーマ [並列可能]
  T02: 認証API ← T01
  T03: フロントエンドUI ← T02
  T04: パスワードリセット ← T02
  T05: ソーシャルログイン ← T02

並列実行計画:
  Wave 1: T01
  Wave 2: T02
  Wave 3: T03, T04, T05 (3並列)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 Phase 4: 並列ワーカー起動
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🚀 Wave 1 起動:
   Worker-T01: Docker container started
   └─ cd ../my-project-T01
   └─ claude --dangerously-skip-permissions

⏳ 進捗監視中...

✅ Wave 1 完了:
   Worker-T01: ✅ 完了 (25分)
     テスト: green
     カバレッジ: 90%
     PR: #18 (Merged)

🚀 Wave 2 起動:
   Worker-T02: Docker container started

✅ Wave 2 完了:
   Worker-T02: ✅ 完了 (45分)

🚀 Wave 3 起動 (3並列):
   Worker-T03: Docker container started
   Worker-T04: Docker container started
   Worker-T05: 🟡 警告 - カバレッジ 75% (目標: 80%)
     → Issue #19 作成
     → 作業継続

✅ Wave 3 完了:
   Worker-T03: ✅ 完了 (40分)
   Worker-T04: ✅ 完了 (30分)
   Worker-T05: ✅ 完了 (70分) - カバレッジ改善完了

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 Phase 5: 振り返り
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 振り返りログ作成: .aad/retrospectives/RETRO-SPEC-001-20260111.md

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ オーケストレーション完了！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 サマリー:
   総所要時間: 3時間10分
   完了タスク: 5/5
   エスカレーション: 1件（警告レベル）
   平均カバレッジ: 85%

次のステップ:
   1. .aad/retrospectives/RETRO-SPEC-001-20260111.md を確認
   2. 次のSPECに着手: SPEC-002
```

## Docker環境設定

`.aad/container/docker-compose.yml` を使用：

```yaml
services:
  orchestrator:
    # 調整役
    environment:
      - ROLE=orchestrator

  worker-1:
    # 並列ワーカー1
    environment:
      - ROLE=worker
      - CLAUDE_CODE_OAUTH_TOKEN=${CLAUDE_CODE_OAUTH_TOKEN}

  worker-2:
    # 並列ワーカー2
```

## エスカレーションハンドリング

### 🔴 即時エスカレーション
- 作業停止
- 全ワーカーを一時停止
- 人間に通知
- 承認後に再開

### 🟡 警告エスカレーション
- 作業継続
- Issue作成
- 通知のみ

## ドライランモード

実行前に計画を確認：

```
/aad:orchestrate SPEC-001 --dry-run

実行計画:
  Wave 1: T01 (1ワーカー)
  Wave 2: T02 (1ワーカー)
  Wave 3: T03, T04, T05 (3ワーカー並列)

予想所要時間: 2-4時間
最大並列度: 3ワーカー

この計画で実行しますか？ (y/n)
```

## オプション

- `--dry-run`: 実行前確認
- `--workers=N`: 最大並列ワーカー数（デフォルト: 3）
- `--no-docker`: ローカル環境で実行（非推奨）
- `--pause-on-error`: エラー発生時に自動停止

## 関連コマンド

- `/aad:tasks` - タスク分割のみ
- `/aad:worktree` - 手動worktree作成
- `/aad:status` - 進捗確認
- `/aad:integrate` - 手動統合
- `/aad:retro` - 振り返り

## 注意事項

- 必ずSPECが承認済みであることを確認してください
- Docker環境が正しく設定されていることを確認してください
- 長時間実行されるため、安定したネットワーク環境が必要です
- エスカレーション発生時は速やかに対応してください
- オーケストレーション中は `/aad:status` で進捗を確認できます
- 完全自動実行は信頼性の高いテストカバレッジが前提です
