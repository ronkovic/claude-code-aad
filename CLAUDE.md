# プロジェクト指示書

このファイルはClaude Codeへの指示書です。プロジェクトのルール、学び、制約を記載します。

---

## 📋 プロジェクト概要

**プロジェクト名**: [プロジェクト名を記入]

**目的**: [プロジェクトの目的を簡潔に記述]

**開始日**: [YYYY-MM-DD]

**現在のフェーズ**: [SPEC / TASKS / TDD / REVIEW / RETRO / MERGE]

---

## ⚙️ プロジェクト設定

| 設定 | 値 |
|------|-----|
| デフォルトブランチ | `main` |

**注**: デフォルトブランチは `/aad:init` で自動検出されます。変更する場合はこの表を更新してください。

---

## 🛠️ 技術スタック

### 言語・フレームワーク
- [例: TypeScript 5.x]
- [例: React 18.x]
- [例: Node.js 20.x]

### テストツール
- [例: Jest]
- [例: React Testing Library]

### Linter/Formatter
- [例: ESLint]
- [例: Prettier]

### その他
- [例: GitHub Actions]
- [例: その他のツール]

---

## 📐 コーディングルール

### 命名規則
- **ファイル名**: kebab-case（例: `user-service.ts`）
- **クラス名**: PascalCase（例: `UserService`）
- **関数名**: camelCase（例: `getUserById`）
- **定数**: UPPER_SNAKE_CASE（例: `MAX_RETRY_COUNT`）

### コードスタイル
- インデント: 2スペース
- 最大行長: 100文字
- セミコロン: 必須
- シングルクォート優先

### コメント
- 複雑なロジックには必ずコメントを追加
- TODOコメントには担当者とIssue番号を記載
  ```typescript
  // TODO(@username #123): ユーザー認証ロジックを追加
  ```

---

## 💬 コミットメッセージ規約

**Conventional Commits形式を使用**

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント変更
- `style`: コードスタイル変更（機能に影響なし）
- `refactor`: リファクタリング
- `test`: テスト追加・修正
- `chore`: ビルド・補助ツール変更

### 例
```
feat(auth): JWT認証機能を追加

- ログインエンドポイントを実装
- トークン検証ミドルウェアを追加

Closes #12
```

---

## 🎯 コンテキスト管理ルール（70%ルール）

| 使用率 | ステータス | アクション |
|--------|------------|------------|
| 0-50% | 🟢 快適 | 通常作業 |
| 50-70% | 🟡 注意 | 大きなタスクは新セッション推奨 |
| 70-85% | 🟠 警告 | `/aad:handoff` 実行推奨 |
| 85-95% | 🔴 危険 | 即座に `/aad:handoff` |
| 95%+ | ⛔ 限界 | 自動圧縮（制御不能） |

**原則**:
- 70%に達したら作業を区切る
- 複雑なタスクは50%以下で開始する
- `/aad:context`コマンドで定期的に確認

---

## 🚨 エスカレーションルール

### 🔴 即時エスカレーション（作業停止）
- セキュリティ脆弱性の発見
- 本番環境への影響が予想される変更
- データ損失のリスクがある操作
- アーキテクチャ変更が必要な問題

**アクション**: 作業停止 → GitHub Issue作成 → 人間に通知

### 🟡 警告エスカレーション（作業継続）
- テストが3回連続で失敗
- カバレッジが70-79%で目標未達
- 外部APIの仕様変更
- 依存ライブラリの非推奨警告

**アクション**: 作業継続 → GitHub Issue作成 → 通知

### 🟢 情報エスカレーション（ログ記録のみ）
- 軽微な設計判断
- パフォーマンス改善の提案
- コードスタイルの統一提案

**アクション**: .aad/retrospectives/にログ記録

---

## 📊 品質ゲート

各フェーズの完了条件：

### SPEC（仕様）
- [ ] 受け入れ基準がテスト可能な形式で記述されている
- [ ] MoSCoWで優先度が設定されている
- [ ] **⚠️ 人間承認必須**

### TASKS（タスク分割）
- [ ] 全タスクにID（SPEC-XXX-TXX）が付与されている
- [ ] 依存関係が明記されている
- [ ] GitHub Issuesが作成されている
- [ ] **⚠️ 人間承認必須**

### TDD（開発）
- [ ] 全テストがgreen
- [ ] カバレッジ80%以上
- [ ] Lint通過
- [ ] `gh pr create --draft`でPR作成完了

### REVIEW（レビュー）
- [ ] AI自己レビュー完了
- [ ] CI green
- [ ] **⚠️ 人間承認必須**

### RETRO（振り返り）
- [ ] .aad/retrospectives/にログ作成
- [ ] CLAUDE.md更新提案

### MERGE（統合）
- [ ] mainマージ完了
- [ ] Issue閉鎖
- [ ] worktree削除

---

## 🧠 学びの蓄積

このセクションはプロジェクトを通じて得た学びを記録します。`/aad:retro`コマンドで自動追記されます。

### [日付] - [タスクID]: [学びのタイトル]

**状況**: [何をしていたか]

**問題**: [何が起きたか]

**解決策**: [どう解決したか]

**学び**: [次回に活かすこと]

---

### 例: 2026-01-15 - SPEC-001-T03: テストデータのクリーンアップ漏れ

**状況**: ユーザー登録機能のテストを実行中

**問題**: テスト間でデータが残留し、次のテストが失敗

**解決策**: `afterEach`フックでデータベースをクリーンアップ

**学び**:
- テストの独立性を保つため、必ず`afterEach`でクリーンアップ
- `beforeEach`でのセットアップとセットで実装する

---

## 🔧 プロジェクト固有の設定

### 環境変数
```bash
# .env.example を参照
DATABASE_URL=
API_KEY=
```

### 開発サーバー起動
```bash
npm run dev
```

### テスト実行
```bash
npm test
npm run test:coverage
```

### Lint実行
```bash
npm run lint
npm run lint:fix
```

---

## 📝 備考

このファイルはプロジェクトの進行に合わせて更新してください。特に「学びの蓄積」セクションは積極的に記録し、チーム全体の知見として共有します。

---

**最終更新**: [YYYY-MM-DD]
**更新者**: [名前またはClaude Code]
