# claude-code-aad v2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

## æ¦‚è¦

claude-code-aad ã‚’ Rust + Ratatui ã§å®Œå…¨æ–°è¨­è¨ˆã—ã€claude-code-monitor ã¨ ralph-tui ã®æ©Ÿèƒ½ã‚’çµ±åˆã™ã‚‹ã€‚

### æŠ€è¡“é¸å®š

| é …ç›® | é¸å®š |
|------|------|
| è¨€èª | Rust |
| TUI | Ratatui + crossterm + tui-realm |
| éåŒæœŸ | tokio |
| ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | handlebars |
| è¨­å®š | TOML |
| CLI | clap |
| Git | git2 |

### é¸å®šç†ç”±

- **æœ€é«˜ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ã‚µãƒ–ãƒŸãƒªç§’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- **ãƒ¡ãƒ¢ãƒªå®‰å…¨**: GCãªã—ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ä¿è¨¼
- **å˜ä¸€ãƒã‚¤ãƒŠãƒª**: ä¾å­˜é–¢ä¿‚ã‚¼ãƒ­ã§é…å¸ƒå®¹æ˜“
- **å …ç‰¢æ€§**: Resultå‹ã«ã‚ˆã‚‹å³æ ¼ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

## ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å±¤æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     cli     â”‚  â”‚     tui     â”‚  â”‚     (å°†æ¥: api)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                      â”‚
          â–¼                â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     application                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ UseCases â”‚  â”‚ Services â”‚  â”‚   DTOs   â”‚  â”‚  Ports   â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                      â”‚
          â–¼                â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Domain Layer                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                       domain                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ Entities â”‚  â”‚  Values  â”‚  â”‚  Events  â”‚  â”‚Repositoryâ”‚ â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚ Objects  â”‚  â”‚          â”‚  â”‚ Traits   â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–²                â–²                      â–²
          â”‚                â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Infrastructure Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    infrastructure                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚   Git    â”‚  â”‚  GitHub  â”‚  â”‚  Claude  â”‚  â”‚   File   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Adapter  â”‚  â”‚ Adapter  â”‚  â”‚ Adapter  â”‚  â”‚ Adapter  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾å­˜é–¢ä¿‚ãƒ«ãƒ¼ãƒ«

```
cli â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚
tui â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ application â”€â”€â†’ domain
                      â”‚           â”‚
                      â”‚           â–¼
                      â””â”€â”€â†’ infrastructure
                                  â”‚
                                  â–¼
                          (å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
                          git2, gh, tokio, etc.
```

- `domain`: å¤–éƒ¨ä¾å­˜ãªã—ï¼ˆç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- `application`: `domain` ã®ã¿ä¾å­˜
- `infrastructure`: `domain` + `application` ã«ä¾å­˜
- `cli` / `tui`: å…¨å±¤ã«ä¾å­˜ï¼ˆDI ã§çµ„ã¿ç«‹ã¦ï¼‰

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
claude-code-aad/
â”œâ”€â”€ Cargo.toml                          # ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å®šç¾©
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE
â”‚
â”œâ”€â”€ crates/
â”‚   â”‚
â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚  Domain Layer (æœ€å†…å´ - ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã€å¤–éƒ¨ä¾å­˜ãªã—)
â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ entities/               # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆè­˜åˆ¥å­ã‚’æŒã¤ï¼‰
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ spec.rs             # Spec ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚       â”‚   â”œâ”€â”€ task.rs             # Task ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚       â”‚   â”œâ”€â”€ session.rs          # Session ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚       â”‚   â””â”€â”€ workflow.rs         # Workflow ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚       â”œâ”€â”€ value_objects/          # å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆä¸å¤‰ï¼‰
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ spec_id.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ task_id.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ phase.rs            # Phase (enum)
â”‚   â”‚       â”‚   â”œâ”€â”€ status.rs           # Status (enum)
â”‚   â”‚       â”‚   â”œâ”€â”€ priority.rs         # Priority (MoSCoW)
â”‚   â”‚       â”‚   â””â”€â”€ quality_gate.rs
â”‚   â”‚       â”œâ”€â”€ events/                 # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ spec_events.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ task_events.rs
â”‚   â”‚       â”‚   â””â”€â”€ session_events.rs
â”‚   â”‚       â”œâ”€â”€ repositories/           # ãƒªãƒã‚¸ãƒˆãƒªãƒˆãƒ¬ã‚¤ãƒˆ
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ spec_repository.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ task_repository.rs
â”‚   â”‚       â”‚   â””â”€â”€ session_repository.rs
â”‚   â”‚       â””â”€â”€ services/               # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚           â”œâ”€â”€ mod.rs
â”‚   â”‚           â”œâ”€â”€ workflow_service.rs
â”‚   â”‚           â””â”€â”€ quality_service.rs
â”‚   â”‚
â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚  Application Layer (ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã€ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ Cargo.toml                  # depends on: domain
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ use_cases/              # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ init_project.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ create_spec.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ split_tasks.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ orchestrate.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ monitor_sessions.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ run_loop.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ persist_state.rs
â”‚   â”‚       â”‚   â””â”€â”€ check_gate.rs
â”‚   â”‚       â”œâ”€â”€ services/               # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ orchestrator.rs     # 3å±¤ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
â”‚   â”‚       â”‚   â”œâ”€â”€ session_manager.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ completion_detector.rs
â”‚   â”‚       â”‚   â””â”€â”€ template_renderer.rs
â”‚   â”‚       â”œâ”€â”€ ports/                  # ãƒãƒ¼ãƒˆï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ git_port.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ github_port.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ claude_port.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ file_port.rs
â”‚   â”‚       â”‚   â””â”€â”€ notification_port.rs
â”‚   â”‚       â””â”€â”€ dto/                    # ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”‚           â”œâ”€â”€ mod.rs
â”‚   â”‚           â”œâ”€â”€ spec_dto.rs
â”‚   â”‚           â”œâ”€â”€ task_dto.rs
â”‚   â”‚           â””â”€â”€ session_dto.rs
â”‚   â”‚
â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚  Infrastructure Layer (å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…)
â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”œâ”€â”€ Cargo.toml                  # depends on: domain, application
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ adapters/               # ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ï¼ˆãƒãƒ¼ãƒˆå®Ÿè£…ï¼‰
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ git/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ git_adapter.rs
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ worktree.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ github/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ gh_cli_adapter.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ claude/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ claude_code_adapter.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ file/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ json_repository.rs
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ toml_config.rs
â”‚   â”‚       â”‚   â””â”€â”€ notification/
â”‚   â”‚       â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚       â””â”€â”€ terminal_notifier.rs
â”‚   â”‚       â”œâ”€â”€ persistence/            # æ°¸ç¶šåŒ–å®Ÿè£…
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ spec_json_repo.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ task_json_repo.rs
â”‚   â”‚       â”‚   â””â”€â”€ session_json_repo.rs
â”‚   â”‚       â””â”€â”€ config/
â”‚   â”‚           â”œâ”€â”€ mod.rs
â”‚   â”‚           â””â”€â”€ toml_loader.rs
â”‚   â”‚
â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚  Presentation Layer (ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹)
â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ main.rs
â”‚   â”‚       â”œâ”€â”€ app.rs                  # DI ã‚³ãƒ³ãƒ†ãƒŠ
â”‚   â”‚       â””â”€â”€ commands/
â”‚   â”‚           â”œâ”€â”€ mod.rs
â”‚   â”‚           â”œâ”€â”€ init.rs
â”‚   â”‚           â”œâ”€â”€ spec.rs
â”‚   â”‚           â”œâ”€â”€ tasks.rs
â”‚   â”‚           â”œâ”€â”€ worktree.rs
â”‚   â”‚           â”œâ”€â”€ orchestrate.rs
â”‚   â”‚           â”œâ”€â”€ status.rs
â”‚   â”‚           â”œâ”€â”€ monitor.rs
â”‚   â”‚           â”œâ”€â”€ loop_cmd.rs
â”‚   â”‚           â”œâ”€â”€ persist.rs
â”‚   â”‚           â”œâ”€â”€ gate.rs
â”‚   â”‚           â”œâ”€â”€ integrate.rs
â”‚   â”‚           â””â”€â”€ retro.rs
â”‚   â”‚
â”‚   â””â”€â”€ tui/
â”‚       â”œâ”€â”€ Cargo.toml
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ lib.rs
â”‚           â”œâ”€â”€ app.rs
â”‚           â”œâ”€â”€ state.rs
â”‚           â”œâ”€â”€ widgets/
â”‚           â”‚   â”œâ”€â”€ mod.rs
â”‚           â”‚   â”œâ”€â”€ session_list.rs
â”‚           â”‚   â”œâ”€â”€ task_progress.rs
â”‚           â”‚   â”œâ”€â”€ spec_tree.rs
â”‚           â”‚   â”œâ”€â”€ context_bar.rs
â”‚           â”‚   â””â”€â”€ phase_indicator.rs
â”‚           â””â”€â”€ views/
â”‚               â”œâ”€â”€ mod.rs
â”‚               â”œâ”€â”€ dashboard.rs
â”‚               â”œâ”€â”€ monitor.rs
â”‚               â”œâ”€â”€ workflow.rs
â”‚               â””â”€â”€ detail.rs
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ aad.toml
â”‚   â”œâ”€â”€ completion-patterns.json
â”‚   â””â”€â”€ prompts/
â”‚       â”œâ”€â”€ child.hbs
â”‚       â”œâ”€â”€ worker.hbs
â”‚       â””â”€â”€ partials/
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â”œâ”€â”€ WORKFLOW.md
â”‚   â”œâ”€â”€ COMMANDS.md
â”‚   â””â”€â”€ QUALITY-GATES.md
â”‚
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â”œâ”€â”€ ci.yml
        â””â”€â”€ release.yml
```

---

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (6ãƒ•ã‚§ãƒ¼ã‚º)

```rust
#[derive(Debug, Clone, PartialEq)]
pub enum Phase {
    Spec,     // ä»•æ§˜æ›¸ä½œæˆ
    Tasks,    // ã‚¿ã‚¹ã‚¯åˆ†å‰²
    Tdd,      // ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º
    Review,   // ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
    Retro,    // æŒ¯ã‚Šè¿”ã‚Š
    Merge,    // çµ±åˆ
}

pub trait PhaseTransition {
    fn can_transition_to(&self, next: &Phase) -> bool;
    fn required_approvals(&self) -> Vec<Approval>;
}
```

### ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ (3å±¤)

```rust
pub struct Orchestrator {
    config: AadConfig,
    sessions: HashMap<SpecId, ChildSession>,
    state: OrchestratorState,
}

impl Orchestrator {
    pub async fn run(&mut self, specs: Vec<SpecId>) -> Result<()> {
        self.register_sessions(&specs).await?;
        self.spawn_children(&specs).await?;
        self.monitor_loop().await?;
        self.finalize().await
    }

    async fn monitor_loop(&mut self) -> Result<()> {
        loop {
            for (spec_id, session) in &mut self.sessions {
                match session.poll().await? {
                    SessionStatus::Running => continue,
                    SessionStatus::Completed => self.handle_completion(spec_id),
                    SessionStatus::Escalated(block) => {
                        self.handle_escalation(spec_id, block).await?
                    }
                    SessionStatus::Failed(err) => {
                        self.handle_failure(spec_id, err).await?
                    }
                }
            }
            if self.all_completed() { break; }
            tokio::time::sleep(Duration::from_millis(
                self.config.orchestration.polling_interval_ms
            )).await;
        }
        Ok(())
    }
}
```

### è¨­å®šã‚¹ã‚­ãƒ¼ãƒ

```rust
#[derive(Debug, Deserialize, Serialize)]
pub struct AadConfig {
    pub general: GeneralConfig,
    pub workflow: WorkflowConfig,
    pub orchestration: OrchestrationConfig,
    pub monitor: MonitorConfig,
    pub loop_engine: LoopConfig,
    pub persistence: PersistenceConfig,
}

#[derive(Debug, Deserialize, Serialize)]
pub struct OrchestrationConfig {
    pub max_parallel_specs: u8,      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2
    pub max_parallel_tasks: u8,      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2
    pub polling_interval_ms: u64,    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3000
    pub max_task_duration_min: u64,  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 60
}
```

---

## ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆ

```toml
[workspace.dependencies]
# éåŒæœŸ
tokio = { version = "1", features = ["full"] }

# ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
serde = { version = "1", features = ["derive"] }
serde_json = "1"
toml = "0.8"

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
handlebars = "5"

# TUI
ratatui = "0.28"
crossterm = "0.28"
tui-realm = "1"

# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
anyhow = "1"
thiserror = "1"

# CLI
clap = { version = "4", features = ["derive"] }

# ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–
notify = "6"

# Git
git2 = "0.19"
```

---

## CLIã‚³ãƒãƒ³ãƒ‰

```bash
# åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰
aad init [--template <name>]     # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
aad spec <name>                  # SPECä½œæˆ
aad tasks <spec-id>              # ã‚¿ã‚¹ã‚¯åˆ†å‰²
aad worktree <task-id>           # worktreeä½œæˆ

# ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
aad orchestrate <spec-id>...     # å…¨è‡ªå‹•å®Ÿè¡Œ
aad orchestrate --resume         # å†é–‹
aad orchestrate --dry-run        # ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³

# ç›£è¦–ãƒ»åˆ¶å¾¡
aad status                       # é€²æ—è¡¨ç¤º
aad monitor                      # TUIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
aad loop <spec-id>               # ã‚¿ã‚¹ã‚¯ãƒ«ãƒ¼ãƒ—
aad persist save|restore         # çŠ¶æ…‹æ°¸ç¶šåŒ–

# å“è³ªç®¡ç†
aad gate <spec-id>               # å“è³ªã‚²ãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
aad integrate <spec-id>          # PRä½œæˆãƒ»ãƒãƒ¼ã‚¸
aad retro                        # æŒ¯ã‚Šè¿”ã‚Š
```

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

| Phase | å†…å®¹ | æœŸé–“ç›®å®‰ |
|-------|------|----------|
| **1** | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€  + domainåŸºç›¤ | 1é€±é–“ |
| **2** | è¨­å®šç®¡ç† + ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | 1é€±é–“ |
| **3** | cli åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰ (init, spec, tasks) | 1é€±é–“ |
| **4** | ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (orchestrate) | 2é€±é–“ |
| **5** | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† + æ°¸ç¶šåŒ– | 1é€±é–“ |
| **6** | tui ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | 2é€±é–“ |
| **7** | ã‚¿ã‚¹ã‚¯ãƒ«ãƒ¼ãƒ— + å®Œäº†æ¤œå‡º | 1é€±é–“ |
| **8** | å“è³ªã‚²ãƒ¼ãƒˆ + GitHubé€£æº | 1é€±é–“ |

**åˆè¨ˆ: ç´„10é€±é–“**

---

## ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

æ—¢å­˜ã® `switch-style.sh` ãŒæä¾›ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡æ›¿æ©Ÿèƒ½ã‚’ Rust + ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«çµ±åˆã™ã‚‹ã€‚

### ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©

| ã‚¹ã‚¿ã‚¤ãƒ« | å®Œäº† | çµæœ | é€šçŸ¥ | ã‚¨ãƒ©ãƒ¼ |
|----------|------|------|------|--------|
| standard | å®Œäº†ï¼š | çµæœï¼š | é€šçŸ¥ï¼š | ã‚¨ãƒ©ãƒ¼ï¼š |
| sage | æˆåŠŸã—ã¾ã—ãŸï¼š | è§£ï¼š | å‘Šï¼š | å¦ï¼š |

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼è­¦å‘Šãƒˆãƒ¼ã‚¯ãƒ³

| ä½¿ç”¨ç‡ | standard | sage |
|--------|----------|------|
| 50-70% | ğŸŸ¡ é€šçŸ¥ï¼šæ³¨æ„ | ğŸŸ¡ å‘Šï¼šä¸­ç¨‹åº¦ |
| 70-85% | ğŸŸ  é€šçŸ¥ï¼šè­¦å‘Š | ğŸŸ  å‘Šï¼šè­¦å‘Šãƒ¬ãƒ™ãƒ« |
| 85-95% | ğŸ”´ é€šçŸ¥ï¼šå±æ©Ÿçš„ | ğŸ”´ å‘Šï¼šå±æ©Ÿçš„ |
| 95%+ | â›”é€šçŸ¥ï¼šé™ç•Œ | â›” å‘Šï¼šé™ç•Œ |

### Domain Layer (ã‚¹ã‚¿ã‚¤ãƒ«é–¢é€£)

```
crates/domain/src/
â”œâ”€â”€ entities/
â”‚   â””â”€â”€ style.rs                    # Style ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”œâ”€â”€ value_objects/
â”‚   â”œâ”€â”€ style_name.rs               # StyleName (standard/sage)
â”‚   â””â”€â”€ token_map.rs                # TokenMap (å¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°)
â””â”€â”€ repositories/
    â””â”€â”€ style_repository.rs         # StyleRepository ãƒˆãƒ¬ã‚¤ãƒˆ
```

#### style.rs
```rust
pub struct Style {
    pub name: StyleName,
    pub tokens: TokenMap,
    pub context_warnings: ContextWarnings,
}
```

#### token_map.rs
```rust
pub struct TokenMap {
    pub completion: String,    // å®Œäº†ï¼š / æˆåŠŸã—ã¾ã—ãŸï¼š
    pub result: String,        // çµæœï¼š / è§£ï¼š
    pub notice: String,        // é€šçŸ¥ï¼š / å‘Šï¼š
    pub error: String,         // ã‚¨ãƒ©ãƒ¼ï¼š / å¦ï¼š
}
```

### Application Layer (ã‚¹ã‚¿ã‚¤ãƒ«é–¢é€£)

```
crates/application/src/
â”œâ”€â”€ use_cases/
â”‚   â”œâ”€â”€ switch_style.rs             # ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡æ›¿
â”‚   â”œâ”€â”€ list_styles.rs              # ã‚¹ã‚¿ã‚¤ãƒ«ä¸€è¦§
â”‚   â””â”€â”€ preview_conversion.rs       # ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³
â”œâ”€â”€ services/
â”‚   â””â”€â”€ style_converter.rs          # å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯
â””â”€â”€ ports/
    â””â”€â”€ style_port.rs               # ã‚¹ã‚¿ã‚¤ãƒ«æ°¸ç¶šåŒ–ãƒãƒ¼ãƒˆ
```

#### switch_style.rs
```rust
pub struct SwitchStyleUseCase {
    style_repo: Arc<dyn StyleRepository>,
    backup_service: Arc<dyn BackupService>,
    converter: StyleConverter,
}

impl SwitchStyleUseCase {
    pub async fn execute(&self, target: StyleName, dry_run: bool) -> Result<ConversionReport>;
}
```

### Infrastructure Layer (ã‚¹ã‚¿ã‚¤ãƒ«é–¢é€£)

```
crates/infrastructure/src/adapters/
â””â”€â”€ style/
    â”œâ”€â”€ mod.rs
    â”œâ”€â”€ style_file_adapter.rs       # .current-style ç®¡ç†
    â”œâ”€â”€ token_replacer.rs           # ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚«ãƒ¼æ–¹å¼ç½®æ›
    â””â”€â”€ backup_adapter.rs           # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®¡ç†
```

#### token_replacer.rs (ãƒãƒ¼ã‚«ãƒ¼æ–¹å¼ç¶­æŒ)
```rust
pub struct TokenReplacer {
    session_id: String,
}

impl TokenReplacer {
    pub fn replace(&self, content: &str, from: &str, to: &str) -> (String, usize) {
        // Step 1: Insert markers
        // Step 2: Replace with markers
        // Same logic as switch-style.sh
    }
}
```

### CLI ã‚³ãƒãƒ³ãƒ‰

```bash
aad style switch <standard|sage> [--dry-run] [--verbose]
aad style current
aad style list
aad style backup list
aad style backup restore [name]
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

`config/styles.toml` ã§ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’ç®¡ç†:

```toml
[styles.standard]
completion = "å®Œäº†ï¼š"
result = "çµæœï¼š"
notice = "é€šçŸ¥ï¼š"
error = "ã‚¨ãƒ©ãƒ¼ï¼š"

[styles.standard.context_warnings]
caution = "ğŸŸ¡ é€šçŸ¥ï¼šæ³¨æ„"
warning = "ğŸŸ  é€šçŸ¥ï¼šè­¦å‘Š"
critical = "ğŸ”´ é€šçŸ¥ï¼šå±æ©Ÿçš„"
limit = "â›” é€šçŸ¥ï¼šé™ç•Œ"

[styles.sage]
completion = "æˆåŠŸã—ã¾ã—ãŸï¼š"
result = "è§£ï¼š"
notice = "å‘Šï¼š"
error = "å¦ï¼š"

[styles.sage.context_warnings]
caution = "ğŸŸ¡ å‘Šï¼šä¸­ç¨‹åº¦"
warning = "ğŸŸ  å‘Šï¼šè­¦å‘Šãƒ¬ãƒ™ãƒ«"
critical = "ğŸ”´ å‘Šï¼šå±æ©Ÿçš„"
limit = "â›” å‘Šï¼šé™ç•Œ"

[backup]
max_count = 3
directory = ".aad/backups/styles"
```

### å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã¸ã®å½±éŸ¿

| Phase | æ—¢å­˜å†…å®¹ | è¿½åŠ å†…å®¹ |
|-------|----------|----------|
| **1** | domain åŸºç›¤ | + Style ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€TokenMap |
| **2** | è¨­å®šç®¡ç† | + styles.toml ãƒ‘ãƒ¼ã‚µãƒ¼ |
| **3** | CLI åŸºæœ¬ | + `aad style` ã‚³ãƒãƒ³ãƒ‰ |
| **5** | æ°¸ç¶šåŒ– | + ã‚¹ã‚¿ã‚¤ãƒ«çŠ¶æ…‹æ°¸ç¶šåŒ–ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |

### æ¤œè¨¼æ–¹æ³•

1. **å˜ä½“ãƒ†ã‚¹ãƒˆ**: TokenReplacer ã®ãƒãƒ¼ã‚«ãƒ¼æ–¹å¼ç½®æ›
2. **çµ±åˆãƒ†ã‚¹ãƒˆ**: ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡æ›¿ â†’ å¾©å…ƒã®å¾€å¾©ãƒ†ã‚¹ãƒˆ
3. **äº’æ›æ€§ãƒ†ã‚¹ãƒˆ**: æ—¢å­˜ `.claude/` ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã®äº’æ›ç¢ºèª

---

## æ¤œè¨¼æ–¹æ³•

1. **å˜ä½“ãƒ†ã‚¹ãƒˆ**: `cargo test`
2. **çµ±åˆãƒ†ã‚¹ãƒˆ**: `cargo test --test integration`
3. **E2Eãƒ†ã‚¹ãƒˆ**: å®Ÿéš›ã®Claude Codeã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã®å‹•ä½œç¢ºèª
4. **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯**: `cargo bench` (èµ·å‹•æ™‚é–“ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡)
